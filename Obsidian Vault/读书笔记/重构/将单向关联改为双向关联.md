---
tags:
  - reference
aliases:
  - Change Unidirectional Association to Bidirectional
refactor_type: 重新组织数据
---
> [!summary] 概要
> 两个类都需要对方的特性，但其间只有一条单向连接。此时应该添加反向指针，并使修改函数能够同时更新两条连接。

> [!summary] 动机
> 如果你发现被引用者需要得到引用者的实例以便进行某些操作，此时就是进行此重构的信号。不过这个手法有点棘手，一定要对访问函数多加测试。

> [!summary] 做法
> 1. 在被引用类中增加一个字段，用来保存反向指针。
> 2. 决定哪一端来控制关联关系。
> 3. 在被控制端建立辅助函数，其命名指出它的有限用途。
> 4. 如果既有的修改函数在控制端，让它负责更新反向指针。
> 5. 否则在控制端新建一个控制函数，让既有的修改函数调用这个新建的控制函数。

> [!example] 范例
> ![[将单向关联改为双向关联 2024-01-16 19.11.59.excalidraw]]
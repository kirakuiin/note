---
tags:
  - reference
aliases:
  - Encapsulate Collection
refactor_type: 重新组织数据
---
> [!summary] 概要
> 有一个函数返回一个集合。那么让这个函数返回该集合的一个只读副本，并在这个类中提供添加/移除集合元素的函数。

> [!summary] 动机
> 如果取值函数直接返回集合自身，这会导致外部对集合修改时类对其一无所知，这也会过多的暴露内部数据结构。因此应该提供额外的函数来操纵集合元素的变化。

> [!summary] 做法
> 1. 加入为集合**添加/移除元素的函数**。
> 2. 将保存集合的字段初始化为一个空集合。
> 3. 找出集合设值函数的全部调用者，修改设值函数令其调用新增的**添加/移除函数**。
> 4. 测试。
> 5. 找出所有通过取值函数来修改集合内容的地方，注意修改它们，令其调用**添加/移除函数**。
> 6. 修改函数自身，令取值函数只返回只读副本。
> 7. 找出取值函数的所有用户，从中找出应该存于集合所属对象内的代码。用[[提炼函数|Extract Method]]和[[Move Method]]将代码移动到集合所属的类中。
> 8. 测试。

> [!example] 范例
> ![[封装集合 2024-01-14 13.48.31.excalidraw]]
---
tags:
  - reference
aliases:
  - Replace Type Code with State/Strategy
refactor_type: 重新组织数据
---
> [!summary] 概要
> 你有一个类型码，它会影响类的行为，但你无法通过继承手法消除它。所以需要以状态对象取代类型码。

> [!summary] 动机
> 如果你重构后打算简化算法，那么采用[[策略模式]]进行重构；如果你打算搬移与状态相关的数据，并且把新建对象视为一种状态迁移，那么[[读书笔记/设计模式/状态模式|状态模式]]会比较好。

> [!summary] 做法
> 1. 使用[[自封装字段|Self Encapsulate Field]]来将类型码自我封装。
> 2. 新建一个类，根据类型码的用途为其命名。
> 3. 为这个新类添加子类，每个子类对应一种类型码。
> 4. 在超类中建立查询函数返回类型码，每个子类进行覆写。
> 5. 在原类中建立一个字段，用来保存新建的状态对象。
> 6. 调整原类中负责查询类型码的函数，将查询动作转发给状态对象。
> 7. 调整原类中类型码的设值函数，将一个新状态对象赋值给状态对象字段。
> 8. 测试。

> [!example] 范例
> ![[以状态或策略取代类型码 2023-12-24 21.18.55.excalidraw]]
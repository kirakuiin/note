---
tags:
  - reference
aliases:
  - Replace Subclass with Fields
refactor_type: 重新组织数据
---
> [!summary] 概要
> 你的各个子类的唯一差别只在某些函数返回的常量数据上。可以修改这些函数，使它们返回超类的某个新增字段，然后销毁子类。

> [!summary] 动机
> 建立子类的目的是为了新增特性或行为，而只提供了一点返回常量区别的子类没有足够的价值，用新增字段替代它们可以降低继承带来的复杂性。

> [!summary] 做法
> 1. 对所有子类使用[[以工厂函数取代构造函数|Replace Constructor with Factory Method]]。
> 2. 如果有任何代码引用子类，令其引用超类。
> 3. 针对每个常量函数，在超类中声明一个字段。
> 4. 为超类声明一个保护构造函数，来初始化这些新增字段。
> 5. 新建或修改子类构造函数，令其调用超类的新增构造函数。
> 6. 在超类中实现所有的常量函数，然后将函数从子类中删除。
> 7. 子类中所有的常量函数都被删除后，使用[[内联函数|Inline Method]]将子类构造函数内联到超类的工厂函数中。
> 8. 删除子类。
> 9. 测试。

> [!example] 范例
> ![[以字段取代子类 2024-01-19 00.42.04.excalidraw]]
---
tags:
  - reference
aliases:
  - Extract Hierarchy
refactor_type: 大型重构
---
> [!summary] 概要
> 你的某个类做了太多工作，其中一部分工作是以大量条件表达式完成的。此时应建立继承体系，以一个子类表示一种特殊情况。

> [!summary] 动机
> 初始开发者只想通过一个类实现一个功能，但随着开发的进行会不断向内部增加新的功能，最后变为一个瑞士军刀般的类，既能开瓶盖，又能砍小树枝。此时你就需要将其各个功能梳理并分开。

> [!summary] 做法
> 有两种主要方式：
> - 你无法确定哪些地方会发生变化，这时你会希望缓慢的改动。
> 	1. 鉴别出一种变化的情况，针对这种情况新建一个子类，然后对原始类实施[[以工厂函数取代构造函数|Replace Constructor with Factory Method]]。然后修改工厂函数，令它返回合适的子类。
> 	2. 将含有条件逻辑的函数，一次一个，逐一复制到子类，简化这些函数。
> 	3. 重复上述过程，将所有变化的情况都分离出来，直到可以将超类声明为抽象类为止。
> 	4. 删除超类中那些被所有子类覆写的函数，将它们声明为抽象的。
> - 你非常清楚原始类会有哪些变化的情况。
> 	1. 针对原始类的每一种变化情况，建立一个子类。
> 	2. 使用[[以工厂函数取代构造函数|Replace Constructor with Factory Method]]将原始类的构造函数转变为工厂函数，并令它针对每一种变化情况返回适当的子类实例。
> 	3. 针对带有条件逻辑的函数，实施[[以多态取代条件表达式|Replace Conditional with Polymorphism]]。如果并非整个函数的行为有所变化，而只是函数的一部分有所变化，那么先用[[提炼函数|Extract Method]]将变化部分和不便部分分隔开来。

> [!example] 范例
> ![[提炼继承体系 2024-01-25 22.52.57.excalidraw]]
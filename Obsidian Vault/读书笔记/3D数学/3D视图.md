---
tags:
  - reference
special_tag: 3D  Math
---
在我们开始渲染之前，必须要确定从哪里渲染和渲染到哪里去。由于输出窗口设定比较简单，就从这个开始。

# 输出窗口

通常来说渲染的图像要被输出到窗口显示器，如下所示。

![[output_window.png]]

渲染位置由窗口的左上角像素坐标和窗口的大小构成，这里采用的都是像素坐标而不是物理坐标。

> [!hint] 渲染目标
> 渲染目标不一定是屏幕，也有可能是一张图片，一个视频文件。

## 像素宽高比

通常来说像素的宽高比应该是$1:1$，即一个正方形，但这不是绝对的。计算公式为：
$$
\begin{align}
pixPhy_x &= \frac{devPhy_x}{devRes_x} \\
pixPhy_y &= \frac{devPhy_y}{devRes_y} \\
\frac{pixPhy_x}{pixPhy_y} &= \frac{devPhy_x}{devRes_x} \cdot
\frac{devRes_y}{devPhy_y} 
\end{align}
$$

$pixPhy$代表像素的大小，$devPhy$代表设备的大小，$devRes$代表分辨率。

# 视锥体

视锥体回答了空间中的哪一部分需要被渲染的问题，它代表了相机在空间中的可视范围。

![[view_frustum.png]]

视锥体由空间中6个无限延伸的**裁剪平面**相交而成，上下左右平面对应着金字塔的腰部，顶底分别代表着近平面和远平面。远平面的存在有以下两个原因：
- 限制渲染的数量。
- 由于深度是由16位存储，最多只能表示65535，所以远平面代表存储在深度缓冲中的最大值。

# 视场角和缩放

相机在透视空间中也是一个具有位置，朝向普通对象，不过它还有两个额外的属性，视场角和缩放。
- 视场角：也叫FOV，水平视场角由两个竖直的**裁剪平面**相交构成，垂直视场角由两个水平的**裁剪平面**相交构成。
- 缩放：当放大时，相机里的对象变大，当所小时，相机里的对象缩小。

水平视场角如下图所示：
![[field_of_view.png]]

而缩放则衡量着当前物体大小和$90\degree$FOV的物体大小比率，例如当缩放为$2.0$时，视野中物体的大小则为$90\degree$FOV下物体大小的2倍。
![[zoom.png]]

由三角函数可以推知：
$$
\begin{align}
zoom &= \frac{1}{\tan(fov/2)} \\
fov &= 2\arctan(1/zoom)
\end{align}
$$

不过有一点需要注意，为了让渲染出来的画面不变形，fov需要设置一个合适的值，加入屏幕的宽大于高，当$fov_x : fov_y = 1$时，那么画面就会被横向拉伸，为了中和这个拉伸，所以$fov_y : fov_x$必须要和屏幕宽高比成反比，所以：
$$
\frac{fov_x}{fov_y} = \frac{winPhy_y}{winPhy_x}
$$


> [!summary] 正交投影的缩放
> 对于正交投影来说，fov是没有意义的，因为正交空间的视锥体是一个长方体，假设视锥体的宽为$size_x$，高$size_y$。
> $$
> \begin{align}
> zoom_x = 2/size_x \\
> zoom_y = 2/size_y
> \end{align}
> $$
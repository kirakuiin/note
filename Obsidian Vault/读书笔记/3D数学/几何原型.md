# 表示法

我们应该如何描述一个几何体呢，一般来说有如下几种形式：
- 隐式形式：可以通过定义一个布尔函数$f(x,y,z)$，对于所有的点位于几何体上时，结果为真，比如方程$x^2 +y^2 + z^2 = 1$。
- 参数形式：也是通过一个函数定义的，但和隐式形式不同的是，几何体上的点不是函数的输入，而是函数的输出，比如：$x(t) = \cos2\pi t, \qquad y(t) = \sin2\pi t$。
- 直接形式：这种形式直接告诉了这个几何体最重要的的信息，比如描述一个线段直接给出了两个点的位置。这也是最容易被人类理解的形式。

# 直线和射线

在标准几何中，有以下几种类型：
- 直线：两端无限延伸
- 线段：直线的有限的一部分，具有两个端点
- 射线：是直线的一半，具有一个原点和无限延伸的另一端。在计算机中它的含义可能是具有方向的线段。

![[line_vs_line_segment_vs_ray.png]]

## 射线

直接形式：$\textbf{p}_{org}$，$\textbf{p}_{end}$
参数形式：$p(t) = p_0 + td, \qquad t \in [0, 1]$

## 直线

隐式形式：$ax + by = d$
![[line_slope_intercept.png]]
使用向量定义的隐式形式：$\textbf{p} \cdot \textbf{n} = d$ 
![[line_normal_and_distance.png]]

它们之间的转换也是非常直接的：
$$
\begin{array}{c}
p_0 = p_{org}, \qquad d = p_{end} - p_{org} \\
p_{org} = p_0, \qquad p_{end} = p_0 + d \\
a = d_y, \qquad b=-d_x, \qquad d = x_{org}d_y - y_{org}d_x\\
ax + by =d \Rightarrow[x, y]\cdot[a,b] = d \Rightarrow\textbf{p}\cdot\textbf{n} = d
\end{array}

$$

# 球和圆

球和圆的隐式形式可以直接根据其定义给出，即“距离空间之一点距离相等的所有点的集合”。

隐式形式：
$$
\begin{array}{c}
\|\textbf{p} - \textbf{c}\| = r \\
(x-c_x)^2 + (y-c_y)^2 = r^2 \\
(x-c_x)^2 + (y-c_y)^2 + (z-c_z)^2 = r^2 \\
\end{array}
$$

> [!summary] 常用公式
> - $\textbf{D} = 2r$
> - $\textbf{C} = 2\pi r$
> - $\textbf{A} = \pi r^2$
> - $\textbf{S} = 4\pi r^2$
> - $\textbf{V} = \frac{4}{3}\pi r^3$

# 边界盒

边界盒指的是包围在几何体周围的长方体，一般用于简化几何体的相交检测等问题。比较常用的类型是长方体的每个边都和主轴平行，这种类型的边界盒叫做**AABB**[^1]

![[aabb.png]]

常用的表示法为直接表示法，即用两个角落点来表示：
$$
\begin{array}{c}
\textbf{p}_{min} = \begin{bmatrix}x_{min} &y_{min} &z_{min}\end{bmatrix} \\
\textbf{p}_{max} = \begin{bmatrix}x_{max} &y_{max} &z_{max}\end{bmatrix} \\
\end{array}
$$
边界盒内每个点一定满足$\textbf{p}_{min} \le p \le \textbf{p}_{max}$。

## 变换AABB

![[aabb_transform.png]]

变化**AABB**往往会产生一个面积更大的新边界盒，这个边界盒可以简单的通过原边界盒的两个顶点和变换矩阵来算出。对原包围盒的的x分量$x_{min}, x_{max}$来说，结果可以表达为：
 $$
\begin{align}
x_{new\_min} =\sum_{n=1}^3\left\{\begin{array}{cc}
x_{min}m_{n1} \qquad &m_{n1} > 0 \\
x_{max}m_{n1} \qquad &m_{n1} \le 0
\end{array}
\right. \\
x_{new\_max} =\sum_{n=1}^3\left\{\begin{array}{cc}
x_{max}m_{n1} \qquad &m_{n1} > 0 \\
x_{min}m_{n1} \qquad &m_{n1} \le 0
\end{array}
\right.
\end{align}
$$
对于$y, z$分量同理。

# 平面

三维空间中的平面的定义是：“到两个点距离相等所有点的集合“，这个和二维空间中直线的定义几乎是一样的，因为它们具有很多共性，它们都将一个空间分为两个半空间。

隐式形式：
$$
\begin{array}{c}
ax + by + cz = d \qquad &(标量表示法) \\
\textbf{p}\cdot\textbf{n} = d \qquad &(向量表示法)
\end{array}
$$

![[plane_front_and_back.png]]
定义中$\textbf{n}$的方向就是平面的正面，根据这个定义也可以推导出$\textbf{n}$一定是垂直与平面的。

也可以通过直接形式，也就是三个不共线的点$\textbf{p}_1,\textbf{p}_2,\textbf{p}_3$来定义平面。
$$
\begin{array}{c}
\textbf{e}_3 = \textbf{p}_2 - \textbf{p}_1 \\
\textbf{e}_1 = \textbf{p}_3 - \textbf{p}_2 \\
\hat{\textbf{n}} = \frac{\textbf{e}_3 \times \textbf{e}_1}{\|\textbf{e}_3 \times \textbf{e}_1\|}\\
d = \textbf{p}_1\cdot\hat{\textbf{n}}
\end{array}
$$
![[plane_from_three_points.png]]]

> [!hint] 点的选取
> 点的选取，向量的叉乘顺序，左手还是右手坐标系都会影响法线向量的正方向。

## 根据多个点构造平面

设点为$\textbf{p}_1, \textbf{p}_2, \cdots, \textbf{p}_{n-1}, \textbf{p}_n$，并且$\textbf{p}_{n+1} \equiv \textbf{p}_1$那么最佳平面法线向量为：
$$
\begin{align}
n_x &= \sum_{i=1}^n(z_i + z_{i+1})(y_i-y_{i+1}) \\
n_y &= \sum_{i=1}^n(x_i + x_{i+1})(z_i-z_{i+1}) \\
n_z &= \sum_{i=1}^n(y_i + y_{i+1})(x_i-x_{i+1}) \\
d &= \frac{1}{n}\sum_{i=1}^n(\textbf{p}_i\cdot\textbf{n})
\end{align}
$$
## 一点到平面的距离

这个根据平面的向量式定义很容易求出，假设这一点为$\textbf{q}$，对应到平面上的最近点为$\textbf{q}^{\prime}$，那么距离$l$为：
$$
\begin{array}{c}
l = (\textbf{q} - \textbf{q}^{\prime})\hat{\textbf{n}}
\end{array}
$$
# 三角形

# 多边形

[^1]: axially aligned bounding box，轴对齐边界盒。
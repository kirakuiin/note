---
tags:
  - reference
design_pattern: Space Partition
category: 优化型模式
---
> [!quote]
   将对象存储在根据位置组织的数据结构中来高效的定位它们。
   >
   对一组对象而言，每个对象都有一个位置，将位置存储在合适的数据结构中以便能够高效查询周围的对象，当位置变化时也要更新数据结构以便继续查询。

使用空间分区一个比较经典的应用场景就是**方格战场**。

```python
class Unit(object):
	def __init__(self, x, y):
		self.X = x
		self.Y = y


class Grid(object):
	WIDTH = 3
	HEIGHT = 3
	def __init__(self):
		self._array = []

	def AddUnit(unit):
		"""根据单位坐标将其划分到9宫格里"""
		pass

	def FindNearUnit(unit):
		"""寻找单位的相邻单位，九宫格的话最多有5个格里的单位可能和其相邻"""
		pass
```

通过根据对象坐标将对象分区，使得战斗仅检测在相邻网格中进行，有效提高了性能。

![[游戏编程模式 2023-10-29 15.37.09.excalidraw]]

> [!hint] 使用场景
> - 必须有一组对象，并且都具有位置信息。
> - 你确实遇到了性能问题(只有几个单位很显然没有性能问题)。
> - 确保你的时间比空间更宝贵(本质上是空间换时间的数据结构)。

> [!hint]
> 1. 分区是层级还是扁平的
>	- 扁平的
>		- 相对简单，数据结构更加容易实现
>		- 内存使用量恒定
>		- 当对象改变位置时可以快速更新(不需要改变多个层级)
>	- 层级的
>		- 可以更有效的处理空白空间，一个少量单位的空白区间只占用一个区间
>		- 更加有效地处理稠密的区间，会将其递归分为若干小区间
> 2. 分区依赖于对象集合吗?
>	- 不依赖于对象
>		- 对象可以逐步的添加
>		- 对象可以快速的移动
>		- 分区不平衡
>	- 分区不依赖于对象，层级依赖于对象(**四叉树**)
>		- 对象可以逐步的添加
>		- 对象可以快速的移动
>		- 分区是平衡的
> 3. 对象只存储于分区中吗?
>	- 如果是唯一存储对象的地方
>		- 避免了维护两个集合的内存开销和复杂性，不必维护其同步
>	- 如果存在另一个集合
>		- 遍历所有对象会更加快速，可以用一个集合维护有效对象

---

> [!summary] 常见分区数据结构
> - [k-d树](https://zhuanlan.zhihu.com/p/53826008)
> - [层次包围盒](https://blog.csdn.net/sunshine543123/article/details/107041122)
> - [四叉树](https://blog.csdn.net/zhouxuguang236/article/details/12312099)
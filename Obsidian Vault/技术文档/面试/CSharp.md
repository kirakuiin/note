#  C#的编译过程

1. 汇编器编译，将源代码编译成中间语言（IL）；
2. 生成程序集，将编译好的IL和元数据打包成程序集（dll或exe）；
3. 在运行时，.NET的公共语言运行时（CLR）会加载程序集，并运用其内部的编译器将其转换为本地的机器码，然后在执行；

# C#闭包概念。

闭包指的是函数引用不在其内部定义的外部变量。C#中闭包会创建一个类对象来存储引用，因此会在堆上分配内存。

# C#中的unsafe是什么？

代表未经验证的上下文。在unsafe关键字内可以使用指针，创建内存块等平时无法使用的操作。

# 值类型和引用类型的区别？

- 值类型基类是`System.ValueType`，存放在栈中，内部存储的是对象的值。
- 引用类型基类是`System.Object`，存放在堆中由GC进行释放，其内部存放的是对象的引用，即地址。

# 什么情况下会触发装箱拆箱

- 将值类型存放到`ArrayList`中会触发装箱。
- 使用上一步中存放的对象会导致拆箱。

# C# GC的流程是如何的？

GC是基于代的，引用跟踪算法回收器。
引用跟踪算法是指：
1. 遍历对中某一代的对象，将其设置为不可达；
2. 从所有的根[^3]出发，将所有可达的对象设置为可达；
3. 将所有不可达的对象回收；
4. 压缩地址，将存活对象连续排列，期间会涉及到数据拷贝，引用更新；

代是基于如下假设成立的：
- 对象越新，生命周期越短；
- 对象越老，生命周期越长；
- 回收堆的一部分速度大于回收整个堆；
所以每经历过一次GC，每被回收的对象就会被放到下一世代，世代越老，回收频率越低。

GC会在以下情况下触发：
- 空间不足。
- 显式调用GC.Collect。
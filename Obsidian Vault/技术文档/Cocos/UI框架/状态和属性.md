---
tags:
  - reference
---

# 类图

![[状态和属性 2024-09-27 15.05.12.excalidraw]]

# 实现细节

每个容器控件都包含一个`status`对象，每个普通控件都包含`attr`对象。当切换状态时：
1. `status`访问状态数据并根据数据得到`attr`对象。
2. 先通过`attr`或是状态数据将所有控件的`attr`状态设置为初始状态。
3. 根据新状态数据设置各个`attr`的新状态。
4. 执行`commit`，各个`attr`实际执行对具体控件的属性设置过程。

状态数据的结构大致如下：
```json
{
	"base" : {
		"ButtonA" : {
			"x" : 30,
			"y" : 40,
		},
		"ImageA" : {
			"path" : "a/b/c.png",
			"x" : 0,
			"y" : 0,
		}
	},
	"A" : {
		"ButtonA" : {
			"x" : 80,
			"y" : 90,
		}
	}
}
```

除了基础状态，每个状态仅包含从基础到当前状态发生变化的数据。这也是流程中必须先切换为基础状态的原因。
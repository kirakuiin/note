---
tags:
  - reference
---
# 流程

![[UI创建过程 2024-09-19 09.34.15.excalidraw]]
# 实现细节

1. 整个创建过程就是将一个多叉树ui描述文件转化为一个多叉控件树的过程。
2. 通过一个字典将ui文件内的控件类型名称转化为对应的创建函数。
3. 每个类型控件的创建函数内部负责控件相关属性的设置。
4. 控件创建完毕后绑定事件和它们的处理函数。

## 事件绑定

整个过程分为两步：

1. 在源代码阶段，用装饰器标记消息函数，并将函数名，需要绑定的控件，以及控件的消息这三个属性存储到类对象中。这一步最关键的逻辑是用`sys._getframe(1)`来在函数的初始化阶段获得类对象。
	```python
	def deco(func):
		# 当绑定一个类的实例方法时，这里获得的实际上时类的属性字典。
		class_dict = sys._getframe(1).f_locals
	```
2. 当ui文件初始化完毕，各种控件已经完成绑定，此时读取保存在类里面的消息列表，根据其中内容将消息函数注册到对应控件的事件上。
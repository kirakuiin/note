---
tags:
  - interview
---
- 担任职务：制作人
- 公司：个人项目
- 项目链接：[卡坦岛](https://github.com/kirakuiin/Catan)
- 使用引擎：Godot3.5
- 使用语言：GDScript
- 主要工作：
	- 游戏的设计
	- 游戏的美术
	- 游戏的制作
	- 游戏的音乐

游戏是对经典德系桌游《卡坦岛》在pc端的重现。支持如下功能：
- 2D游戏界面。
- 规则全部由程序进行执行。
- 最多支持6人局域网联机。
- 支持自定义地图编辑器，可以自定义地图。

# 游戏实现

UI界面全部使用Godot制作，这部分比较简单。

服务端采用分层状态机来表示卡坦岛的执行逻辑。

游戏中比较复杂的地方在于：
- 对六边形的支持，六边形的点的表示法以及各种运算方式。
- 图论算法，包含地图生成，最长道路检测，临接检测等等。
- 分层状态机的状态转换，这部分写的是死代码，不太容易修改。

![[卡坦岛核心类图]]

## 六边形的支持

参考文章[六边形网格](https://www.redblobgames.com/grids/hexagons/)，这里对六边形的各种形式，原理，表示法，运算都做了详细的说明，项目里是用Godot支持了内部的部分操作。并延伸出了点的表示法，当用立方坐标表示时，六边形坐标系中的任意一点满足：
$$
|s+r+q| = 1
$$

## 均匀地图生成

使用邻接矩阵表示六边形地图，采用随机+BFS+优先队列来填满地图上的点数和地块类型。

## 网络通讯

网络部分使用Godot内建的高级多人网络基础设施，通过其内置的RPC来发送数据。

使用的是状态同步，创建主机的玩家同时作为服务端。
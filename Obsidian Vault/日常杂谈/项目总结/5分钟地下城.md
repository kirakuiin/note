---
tags:
  - interview
---
- 担任职务：制作人
- 公司：个人项目
- 项目链接：[5分钟地下城](https://github.com/five-minute-dungeon/)
- 使用引擎：Unity2022.3.29f1
- 使用语言：C#
- 主要工作：
	- 游戏的设计
	- 游戏的美术
	- 游戏的制作
	- 游戏的音乐

游戏是对经典桌游《5 minutes dungeon》在pc端的重现。支持如下功能：
- 规则全部由程序进行执行。
- 最多支持5人局域网联机。
- 3D游戏界面，有着华丽（QWQ）的演出。

# 游戏实现

UI界面全部使用Unity制作，主要的复杂度集中手中卡牌的表示法，目前采用的方案是用员的一段弧表达卡牌应该分布的位置，采用Dotween来实现卡牌的运动动画。

这个游戏的主要复杂度是怎么样实现一个灵活的，可配置的卡牌系统。目前的实现思路是用XNode插件做了一个技能编辑器，特效编辑器，从而将技能的逻辑从代码中剥离，可以灵活的进行组合和测试。

游戏的服务端采用的是一个简单的状态机，不断的监听玩家的输入，当玩家打出卡牌就执行玩家卡牌ID所对应的那个技能节点里的逻辑；当当前关卡通过就切换到下一关。

![[5分钟地下城核心类图]]

## 卡牌技能系统

使用XNode实现，每个技能是一个图，而图中包含若干节点，节点有如下基本类型：
- 抽n张牌；
- 弃n张牌；
- 给别人n张牌；
- 消灭敌人；
- 弃牌堆洗回牌库；
- 产生资源；
- 播放技能，这里会使用下一节里实现好的图。

所有的技能和关卡特效基本上都是上述节点的排列组合，所以通过这些基本节点的组合，可以非常快速的制作出大量技能效果。

每一个图和节点本质上都是用命令模式实现的，它们都支持一个`Execute`接口，服务端通过调用图对象来依次执行其内部节点的`Execute`来执行卡牌效果。

如果节点之间有明显的前后关系，或者某个效果依赖于玩家的输入，这里是使用C#里的异步来实现的。
## 技能特效系统

也是通过XNode实现的，这个参考了之前再多益时的蓝图编辑器，提供了特效播放，人物动画播放，投射物播放等多个子节点，通过将这些节点组合来构成一个完整图来表达技能效果。

## 网络

网络部分使用的是[Netcode for GameObjects](https://docs-multiplayer.unity3d.com/netcode/current/about/)，这是一个高层次的网络库，内部集成了连接管理，对象同步，场景同步等多种功能。对于这部分内容，用一个单独的项目进行了一层包装[UnityGameLib](https://github.com/kirakuiin/UnityGameLib)。通过PackageManager的Git链接导入项目中。

使用的是状态同步，创建主机的玩家同时作为服务端。

## 音乐

音乐部分直接使用的免费的Unity Asset。使用一个全局的音乐管理器来控制音乐播放。

## 模型

模型使用Unity商店提供的免费Assets。

## 特效

大部分特效用的Unity商店的免费Assets。

小部分定制特效是Unity使用VfxGraph+ShaderGraph来实现。
- 激光，火球这种通过VfxGraph实现。
- 时停，溶解这种效果通过ShaderGraph+后处理来实现。

## 测试

使用ParrelSync克隆多个项目，但内部数据保持同步，然后开启多个Unity编辑器进行本地测试。
---
tags:
  - interview
---
- 担任职务：前端开发工程师
- 公司：多益
- 使用引擎：Cocos2d（多益魔改版）
- 语言：python2.7
- 主要工作：
	- 实现业务逻辑。
	- 开发维护战斗模块。

# 业务流程

1. 和策划，服务端一起核对需求，看需求是否有问题，是否能够正常执行。
2. 根据需求实现导表，所谓导表就是一种二维表格，内部包含了游戏内执行时需要的各种数据，一般是策划设计，程序实现，策划填充数据。
3. 对需求建模，设计出所需要实现的数据类。这一步是[[MVC模式]]中的**M**。
	- 设计类的职责，比如读取，操作，访问的接口。
	- 设计类会产生的事件，这里不要跟UI联系到一起，而是要根据类的特性出发来设计。这里一般使用发布订阅模式来设计，用一个第三方信号槽来充当中间人。
4. 实现网络交互部分，这里主要负责实现两种类型的逻辑，客户端到服务端的请求，以及服务端到客户端的回复。服务端根据需求会提供一个包含协议的文本文件，内部详细定义了每个协议的参数。客户端需要根据这些协议实现具体的函数来执行功能。
	- 客户端到服务端的请求会用一个函数来实现，这个函数的参数就是服务端需要的参数。
	- 服务端到客户端的请求也用一个函数来实现，这个函数的参数就是服务端发来的数据。一般来说这里的函数只会调用模型层的函数来设置数据。
5. 实现控制层**C**，策划会制作好UI，通过UI编辑器生成的py文件就是**V**。客户端需要在控制层加载UI，在这里实现对各种UI操作的响应，比如按钮点击，列表拖动。
	- 这里会用函数注册到信号槽，表明对某个数据的关注，并在函数内部实现相应的逻辑。
	- 这里会执行各种UI事件的绑定，绑定函数内部包含处理UI事件的逻辑。
	- 这里可以直接访问网络层，比如点击某个按钮就向服务器请求某个数据。
6. 本地用模拟数据执行测试和检查，排查编程中出现的明显错误。
7. 和服务端进行联合调试，在服务端的个人服务其中进行测试。
8. 联调通过后，通知策划进行验收。验收过程中可能还需要对Bug进行修复。
9. 验收通过后，业务流程结束。

UI生成流程图：
![[ui-process.png]]

# 战斗模块

战斗模块整体上是一个以组件结构为基础的，通过命令模式驱动的模块。

战斗模块的`client`对象就是一个空的实体，其内部所有的功能都是由它的子组件来实现的。

![[幻唐志-洪荒再现 2024-08-25 16.40.28.excalidraw]]

通过指令模式将网络数据和具体执行解藕，通过在指令中通过组件系统和接口索引组件，将功能和实现相分离。这套体系具有如下优点：
- 同一个接口可以用多个不同的组件实现，通过组装不同的组件就可以实现不一样的战斗系统，并且添加新组件时不需要修改已经存在的代码，符合[[什么是面向对象#开闭原则]]。
- 指令系统通过接口联系到组件，两者都依赖抽象，而不是依赖细节，符合[[什么是面向对象#依赖倒置原则]]。
- 每个接口的功能都很单一，但组件可以按需实现多个接口，这符合[[什么是面向对象#接口分离原则]]。
- 可以在运行时动态的添加，删除组件来支持新的功能，非常灵活。

举个例子：比如策划想要为战斗中出现的暴击加一个全屏震动的特效，那么可以通过如下步骤实现这个功能：
- 找到对应代表角色受伤的那个接口。
- 新建一个类，继承`Component`和这个接口，接口中实现震动的逻辑。
- 讲这个组件加入到战斗时客户端中。

## 指令系统

整个指令系统负责充当服务端数据和游戏逻辑的中间件。这个系统的主要复杂度在于两点：
- 指令是支持任意层的嵌套的，A包含B，B包含C，D；
- 指令支持串行和并行；

嵌套结构会在指令生成阶段递归结算，而并行和串行是通过分两个队列来处理，并行的放到一个，串行的放到另一个。

## 蓝图

游戏中的角色动画，技能特效都是通过蓝图编辑器来实现的。蓝图编辑器就是一种可视化的控制流，由一个个功能块和它们之间的连接构成，比较常见的功能模块有：
- 延迟
- 播放粒子
- 播放骨骼动画
- 移动
- 渐入渐出
- 缩放
- 发送信号

而各种连接代表着功能块之间的顺序，前一个块结束，才会走到后面的。

策划会编辑好蓝图，并生成一蓝图文件，将所有的蓝图的文件存在一个文件夹中，并用一个合适的ID进行编号，然后将ID存放到技能表中的技能ID关联起来。

在战斗执行的过程中，如果收到释放技能的指令，就会根据蓝图ID查找对应的蓝图文件，然后利用编辑器提供的播放器类进行播放。蓝图播放器需要如下参数：
- 蓝图文件路径；
- 对象映射信息，比如攻击者A对应的真实对象，被攻击者A对应的真实对象，游戏中心位置等等。

整个流程中最重要的一点是，要监听蓝图里配置的信号，一般这种信号代表着某个对象被击中。此时释放技能指令内部就会执行内部包含的子指令，可能是另一个释放技能指令，也可能是一个简单的伤害数值。
# 总述
---
上半年的工作总的来说可以分为以下四种类型：
- 各种维护单，以及一些固定周期的工作。（比如值日，值周等）
- 对一些老玩法的迭代。（比如三界菁英moba3.0，勋章系统）
- 全新玩法的制作。（比如单人地宫的几个子系统）
- 战斗系统相关的开发。（比如巅峰赛，封神之战，门派调整等）

# 工作结果
---
## 工作成果
---
这里说明一下几个比较重要的工作内容。

### 三界菁英moba3.0
---
这个单子的内容比较多，我主要负责实现其中新增的几个子系统以及一些整体性的内容调整。
- 导表迁移：将2.0的导表升级为新格式的3.0导表。
- 刻印和专属经脉：制作两个新增的子界面。
- 主界面的迭代：新增任务面板，角色锦衣展示面板。
- 引导系统迭代：由于新增了不少玩法，引导系统也同步迭代。

这其中比较复杂的地方在于导表迁移。主要由于以下几点导致其比较困难：
1. 旧导表是采用py手工导表的，而新导表需要用jinja来导出，由于旧表存在大量特殊的处理，导致迁移过程比较复杂。
2. 旧导表和新导表在大量字段上产生了含义上的区别，而旧导表还被数十个文件引用，导致兼容非常复杂。
3. 这数十个文件中有很多文件还是废弃的（比如19年版本的，20年版本的，等等），并且文件之间存在大量的交叉引用，给迭代后测试增加了不少难度。

最后的解决方案是：
1. 首先用一个函数来封装对导表的直接访问，其他地方改为调用函数。
2. 修改所有使用导表数据的位置，将其改为对函数的调用。
3. 实机运行，尽量覆盖到所有修改的位置，确认一下修改的结果。
4. 如果还有覆盖不到的，请求老前辈的支援来确认下。
5. 最后删除掉所有无效的代码，降低后续的维护难度。

### 勋章系统新增见闻勋章
---
这个制作本身并不复杂，就是常规的页面迭代，功能添加。不过这个工单制作时花了不少时间，主要是两个难点：
1. 勋章的每个尺寸，动画，对应的彩饰都有单独的资源，最后这个工单大概添加了500+的新增资源，其中很多都需要手工调整key点来校正效果。
2. 策划给勋章新增了一个持续时间的概念。这个概念只能由服务端来存储，而有八个协议以及十多个界面需要适配新增的数据，导致修改非常容易出现遗漏和错误。

最后的解决方案是：
1. 编写脚本进行批处理，虽然没法完全解决问题，但至少减少了60%的工作量。
2. 全局搜索，对所有涉及到的地方进行修改时，对输入的数据源进行严格的验证，保证不抛出异常，即便数据不对也不要导致流程中断。

### 4月门派调整
---
这个工单主要做了一些技能表现相关的内容，这个工单初步接触了技能、buff的制作流程。

这个工单的主要难点是对整个战斗系统不太熟悉，比如添加buff，增加一些表现，不知道该如何下手。

解决方案就是：
1. 碰到不知道如何下手的地方，直接咨询导师。
2. 根据导师的建议，调试研究流程的代码。
3. 搞清流程后开始添加功能。

### 单人地宫
---
这个工单负责制作两个新增的UI，主要的难点是其中有一个界面是对以前一个复杂老界面的部分复用，需要保持功能一致，但两者的数据来源是完全不同的。

这里的处理方案是复制其中大部分的逻辑，然后提取出数据设置相关的接口，容易适配的就直接把这边的数据适配为那边的格式，不好适配的就重写一下。这里不采用继承的原因是两个界面根本上也不符合”is a“的模型，所以单纯的代码复用继承非常容易给后人挖坑，导致修改基类引发派生类报错。

### 封神之战ai战斗
---
这个工单主要实现两个功能，一个是剧情播片无缝过渡到战斗，一个是战斗结尾动画实现一些特殊的播片效果。

虽然过渡和结尾动画确实有现存的工具，但是都有一些额外功能是这个现存的工具无法完成的。因此必须扩充一下现有工具的逻辑。

1. 对于阵法技编辑器，新增了回调功能，支持在每个指令后处理程序的Hook。用来实现一些客制化功能。
2. 对于剧情编辑器，支持了传入完整的NPC锦衣参数和染色参数，可以完整的渲染出NPC的形象。

### 技能信息优化
---
这个工单的要求是修正现在一些技能的描述（魔法消耗，警告信息等）不准确的问题。

本身工单不是特别复杂，但是这部分实现的逻辑是HT一个版本，PC一个版本，为了方便调整和后续迭代，将两边的合并为一个，并且将一个几百行的大函数按功能拆分成一个个10行左右的小函数。

为了保证外服不出问题，原有的逻辑还会保留，并且外放的前两周会同时运行新旧逻辑，如果出现不一致则报警。将问题都修复完毕后在删除旧逻辑。

## 反思和不足
---
1. 对有些系统的了解还是不够，经常会碰到无法定位功能入口的情况。
2. 制作功能的时候偶尔会出现推倒之前的某些设计重来的情况，事先的设计不够完善。
3. 文档总结的数量还是比较少，没有把一些踩到的坑传递给其他人。

## 规划完成情况
---
1. 学习了不少新的模块（完成），比如战斗，组件等系统。
2. 制作一些有意思的新功能（完成），比如封神ai战，各种技能效果等。
3. 有余裕来完成抢单任务（未完成），总体来说感觉还是挺忙的，没抽出空来。

# 学习和分享
---
主要学习了：
- 战斗模块的主要流程
- buff的制作流程
- ets技能的制作流程
- 剧情编辑器和阵法技编辑器的使用方式和原理
- 复杂导表的导出方式，导表的sunshine自动化等。

文档：
- 阵法技编辑器使用指南

# 下半年规划
---
- 整理战斗中ui的基本流程
- 熟悉战斗模块站位的工作原理
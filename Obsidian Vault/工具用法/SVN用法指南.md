---
tags:
  - svn
  - reference
---
SVN是SubVersion的简写，是一个版本管理控制系统，主要用于解决以下问题：
- 追踪文件的变更历史；
- 记录修改的事件，原因，内容；
- 支持多人协作；
- 可以合并，回退不同版本；

# 认识仓库地址

![[SVN用法指南 2024-09-20 17.54.06.excalidraw]]

svn支持多种协议：
- file:// 访问本地磁盘。
- http://, https:// 通过webdav协议访问。
- svn:// 通过自定义协议访问svn服务器。
- svn+ssh:// 通过ssh加密后的自定协议来访问svn服务器。

# 认证方式

- 通过https://协议认证需要通过明文认证，方便但不安全。
- 通过svn://+kerberos认证，即安全又安全，不过需要通过`kinit`来初始化认证信息。

# 结构

![[SVN用法指南 2024-09-20 19.44.00.excalidraw]]


# 工作流

1. 在远程仓库上创建一个你想要工作的[[#打出分支]]。
2. [[#检出]]到本地。
3. 修改文件内容，然后执行[[#本地修改]]指令。
4. [[#提交]]。
5. 如果有其他人协作，可能还需要[[#更新]]和[[#合并]]，[[#打补丁]]。
6. 如果出现冲突，则需要[[#解决冲突]]。

# 基本操作

## 显示仓库信息

```svn
svn info [URL[@Revision]]
```

## 查看仓库内文件

```svn
svn list [URL[@Revision]]
```
## 打出分支

```svn
svn copy SRC[@Revision] DST
```

这个指令既可以用来从某个仓库打出一个分支，打出的粒度最低可以到单个文件；也可以用来在当前**工作目录**[^1]复制文件。采用那个功能取决于你的`SRC`参数是文件还是仓库。

> [!hint] 最佳实践
> 在命令的后面输入`-m "comment"`来表明你这次拷贝的意图。

## 检出

```svn
svn checkout URL[@Revision]... [PATH]
```

检出是指将远程仓库下载到本地目录的过程，检出的这个目录也叫做**工作目录**[^1]。

## 更新

```svn
svn update [-r revision arg]
```

同步当前**工作目录**[^1]内容到服务端的指定版本，默认最新。

> [!hint] 最佳实践
> 每次想要修改文件之前，一定要更新一下，避免冲突。

## 查看工作目录状态

```svn
svn status [PATH...]
```

一些比较常用的符号有：
- 'A'：新增
- 'D'：删除
- 'I'：忽略
- 'C'：冲突
- 'M'：修改
- 'R'：替换
- '?'：未被SVN管理
- '!'：文件缺失

## 差异

```svn
svn diff [-r [N[:M]]] [PATH...]
```

默认情况下对比工作目录对当前版本的修改。

> [!hint]
> 这里需要注意一下`N, M`两个参数，它们代表了两个对比的范围，反应的是从`N`到`M`的差异，如果反过来写为`M:N`，那就是从`M`到`N`的差异，这两个的变化方向是相反的。

## 本地修改

```
svn add PATH...
svn delete PATH... | URL
svn move PATH1 PATH2
svn rename PATH1 NEWNAME
```

## 提交

```svn
svn commit [PATH...]
```

将本地修改提交到仓库。

> [!hint] 最佳实践
> 提交时一定要用`-m "comment"`来写清楚这次提交的目的。

## 本地撤回

```svn
svn revert PATH...
```

将本地的文件撤回到未修改之前的状态。如果有冲突标记也会被移除。

## 合并

```svn
svn merge [-r N:M ...] SOURCE[@Revision] [WCPATH]
```

-r参数指定了将要参与合并的版本。WCPATH指定了合并将要应用的目录。(WC指working copy)

合并的主要作用是：
- 撤回已经提交的修改。
- 将另一个分支的修改合并到本分支。

> [!hint]
> 合并后变化仅存在于本地，想要版本库同步必须要提交。

## 打补丁

```svn
svn patch PATCH_FILE [WCPATH]
```

将补丁文件应用到本地路径上，如果不指定WCPATH，那么应用到执行指令的当前目录。

补丁文件通过`svn diff > xxx.patch`来生成。

## 解决冲突

```svn
svn resolve [PATH...]
```

当更新和合并时，如果本地和远程同时对某个文件做了冲突性的改变，此时就会出现冲突。文件的状态会被标记为`'C'`，需要本地修改这个冲突文件来解决冲突。当你修改冲突文件完毕后，需要执行这个指令来移除冲突标记。

## 切换工作目录

```svn
svn switch URL
```

如果想要在另一个版本下工作，使用切换相比于检出会节省大量的时间。

# 特殊记号

- `^`代表版本库的根目录，比如`^/trunk`就代表版本库根目录下的`trunk`目录。
- `@`指定特定的版本号，比如`svn cat file.txt@100`显示的就是版本号为100的文件内容
- `head`代表版本库中的最新版本。**注意指的不是工作目录[^1]的最新版本，而是整个版本库的**。
- `prev`代表**工作目录**[^1]前一个版本。在不同的上下文中其指代的版本不同。
- `base`代表**工作目录**[^1]的基础版本。它代表了最后一次从版本库更新的版本。
- `committed`代表**工作目录**[^1]最后一次提交时的版本。

[^1]: 使用检出功能后文件存在的那个目录。